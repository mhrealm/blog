---
import { CldImage } from "astro-cloudinary";

const menus = [
  {
    name: "react笔记",
    href: "/react-note/",
  },
  {
    name: "博客",
    href: "/blog/",
  },
  {
    name: "我的项目",
    href: "/projects/",
  },
  {
    name: "工具集合",
    href: "/tools/",
    isNew: true,
  },
];
---

<header
  class="sticky top-0 z-50 w-full border-b border-gh-border bg-gh-bg/80 backdrop-blur-lg backdrop-saturate-150"
>
  <nav class="max-w-6xl mx-auto px-4 sm:px-6 flex items-center justify-between h-14 sm:h-16">
    <a
      href="/"
      class="flex items-center gap-2 sm:gap-3 group"
    >
      <div class="relative w-8 h-8 sm:w-10 sm:h-10">
        <CldImage
          src="me_kknemi"
          width={100}
          height={100}
          loading="eager"
          class="rounded-full ring-2 ring-gh-border group-hover:ring-indigo-500 transition-all duration-300"
          alt="mh"
        />
        <span
          class="absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 sm:w-3 sm:h-3 bg-green-500 rounded-full border-2 border-gh-bg"
        >
        </span>
      </div>
      <span
        class="font-medium text-sm sm:text-base text-gray-400 group-hover:text-white transition-colors inline"
      >
        mh
      </span>
    </a>

    <div class="flex items-center gap-0.5 sm:gap-2">
      <!-- Desktop Navigation -->
      <div class="hidden sm:flex items-center gap-1 select-none mr-4">
        {
          menus.map((menu) => (
            <a
              href={menu.href}
              class="relative px-3 py-2 rounded-lg text-sm text-gray-400 hover:text-white hover:bg-gh-surface transition-all"
            >
              {menu.name}
              {menu.isNew && (
                <span class="absolute -top-[3px] -right-4 flex h-4 w-8 items-center justify-center rounded-full bg-indigo-500 text-[8px] font-bold text-white ring-2 ring-gh-bg">
                  NEW
                </span>
              )}
            </a>
          ))
        }
      </div>

      <!-- Mobile Navigation Dropdown -->
      <div
        class="sm:hidden relative inline-block text-left"
        id="nav-dropdown"
      >
        <button
          id="nav-dropdown-btn"
          class="px-2.5 py-2 rounded-lg text-sm text-gray-400 hover:text-white hover:bg-gh-surface transition-all flex items-center gap-1 active:scale-95"
        >
          导航
          <svg
            class="w-4 h-4 transition-transform duration-200"
            id="nav-dropdown-icon"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
              clip-rule="evenodd"
            >
            </path>
          </svg>
        </button>
        <div
          id="nav-dropdown-content"
          class="hidden absolute right-0 mt-2 w-36 rounded-xl bg-gh-surface/95 border border-gh-border shadow-2xl overflow-hidden z-50 backdrop-blur-xl animate-in fade-in zoom-in-95 duration-200"
        >
          {
            menus.map((menu) => (
              <a
                href={menu.href}
                class="flex items-center justify-between px-4 py-3 text-sm text-gray-200 hover:text-white hover:bg-white/5 transition-colors border-b border-gh-border/50"
              >
                {menu.name}
                {menu.isNew && (
                  <span class="px-1.5 py-0.5 rounded-full bg-indigo-500 text-[8px] font-bold text-white">
                    NEW
                  </span>
                )}
              </a>
            ))
          }
        </div>
      </div>

      <div class="w-0.5 h-4 sm:h-4 bg-gh-border mx-2"></div>
      <a
        href="https://juejin.cn/user/712139267641950"
        class="p-1 rounded-lg text-gray-400 hover:text-blue-500 hover:bg-gh-surface transition-all"
        title="掘金"
        target="_blank"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 36 28"
          fill="currentColor"
          class="w-6 h-6 sm:w-7 sm:h-7"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M17.5875 6.77268L21.8232 3.40505L17.5875 0.00748237L17.5837 0L13.3555 3.39757L17.5837 6.76894L17.5875 6.77268ZM17.5863 17.3955H17.59L28.5161 8.77432L25.5526 6.39453L17.59 12.6808H17.5863L17.5825 12.6845L9.61993 6.40201L6.66016 8.78181L17.5825 17.3992L17.5863 17.3955ZM17.5828 23.2891L17.5865 23.2854L32.2133 11.7456L35.1768 14.1254L28.5238 19.3752L17.5865 28L0.284376 14.3574L0 14.1291L2.95977 11.7531L17.5828 23.2891Z"
          >
          </path>
        </svg>
      </a>
      <a
        href="https://github.com/mhrealm"
        class="p-1 rounded-lg text-gray-400 hover:text-white hover:bg-gh-surface transition-all"
        title="GitHub"
        target="_blank"
      >
        <svg
          class="w-7 h-7 sm:w-8 sm:h-8"
          viewBox="0 0 24 24"
          fill="currentColor"
        >
          <path
            d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.17 6.839 9.49.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.604-3.369-1.34-3.369-1.34-.454-1.156-1.11-1.464-1.11-1.464-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.831.092-.646.35-1.086.636-1.336-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.578.688.48C19.138 20.167 22 16.418 22 12c0-5.523-4.477-10-10-10z"
          >
          </path>
        </svg>
      </a>
    </div>
  </nav>
</header>

<script>
  function initNavDropdown() {
    const btn = document.getElementById("nav-dropdown-btn");
    const content = document.getElementById("nav-dropdown-content");
    const icon = document.getElementById("nav-dropdown-icon");

    if (!btn || !content || !icon) return;

    // Toggle dropdown
    btn.addEventListener("click", (e) => {
      e.stopPropagation();
      const isHidden = content.classList.contains("hidden");

      if (isHidden) {
        content.classList.remove("hidden");
        icon.classList.add("rotate-180");
      } else {
        content.classList.add("hidden");
        icon.classList.remove("rotate-180");
      }
    });

    // Close on click outside
    document.addEventListener("click", (e) => {
      if (!content.contains(e.target as Node) && !btn.contains(e.target as Node)) {
        content.classList.add("hidden");
        icon.classList.remove("rotate-180");
      }
    });
  }

  // Initialize on first load
  initNavDropdown();

  // Re-initialize after Astro view transitions
  document.addEventListener("astro:page-load", initNavDropdown);
</script>
