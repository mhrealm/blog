---
import { getCollection } from "astro:content";

const posts = (await getCollection("blog", ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<div class="py-20 lg:py-32">
  <!-- Section Header -->
  <div class="text-center mb-16">
    <p
      class="text-sm font-medium text-indigo-600 dark:text-indigo-400 uppercase tracking-widest mb-3"
    >
      Writing
    </p>
    <h2 class="text-3xl lg:text-4xl font-bold text-zinc-900 dark:text-white">最新文章</h2>
    <p class="text-zinc-500 dark:text-zinc-400 mt-4 max-w-2xl mx-auto">
      技术分享、开发心得、学习笔记
    </p>
  </div>

  <!-- Posts Grid -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
    {
      posts.map((post) => (
        <a
          href={`/blog/${post.slug}`}
          class="group block"
        >
          <article class="h-full flex flex-col bg-white dark:bg-zinc-900 rounded-2xl border border-zinc-200 dark:border-zinc-800 overflow-hidden hover:border-indigo-500/50 transition-all duration-300">
            {post.data.cover && (
              <div class="aspect-[16/9] overflow-hidden">
                <img
                  loading="lazy"
                  src={post.data.cover}
                  alt={post.data.title}
                  class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                />
              </div>
            )}
            <div class="p-6 flex-1 flex flex-col">
              <time
                class="text-sm text-zinc-500 dark:text-zinc-400"
                datetime={post.data.pubDate.toISOString()}
              >
                {post.data.pubDate.toLocaleDateString("zh-CN", {
                  year: "numeric",
                  month: "long",
                  day: "numeric",
                })}
              </time>
              <h3 class="text-lg font-semibold text-zinc-900 dark:text-white mt-2 mb-2 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors line-clamp-2">
                {post.data.title}
              </h3>
              <p class="text-sm text-zinc-600 dark:text-zinc-400 line-clamp-2 flex-1">
                {post.data.description}
              </p>
            </div>
          </article>
        </a>
      ))
    }
  </div>

  {
    posts.length === 0 && (
      <div class="text-center py-12">
        <p class="text-zinc-500 dark:text-zinc-400">暂无文章，敬请期待...</p>
      </div>
    )
  }

  <!-- View All Link -->
  {
    posts.length > 0 && (
      <div class="text-center mt-12">
        <a
          href="/blog"
          class="inline-flex items-center gap-2 px-6 py-3 rounded-full bg-zinc-100 dark:bg-zinc-900 text-zinc-900 dark:text-white font-medium border border-zinc-200 dark:border-zinc-800 hover:border-indigo-500/50 transition-all"
        >
          <span>查看全部文章</span>
          <svg
            class="w-4 h-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M17 8l4 4m0 0l-4 4m4-4H3"
            />
          </svg>
        </a>
      </div>
    )
  }
</div>
